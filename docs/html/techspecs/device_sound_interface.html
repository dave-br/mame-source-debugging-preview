<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The device_sound_interface &mdash; MAME Documentation 0.279 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/documentation_options.js?v=1a7c6e39"></script>
        <script src="../_static/doctools.js?v=9bcbadda"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Emulated system memory and address spaces management" href="memory.html" />
    <link rel="prev" title="The device_disasm_interface and the disassemblers" href="device_disasm_interface.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            MAME Documentation
          </a>
              <div class="version">
                0.279
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../whatis.html">What is MAME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../healthwarning.html">Health Warnings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../initialsetup/index.html">Getting MAME prepared</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usingmame/index.html">Basic MAME Usage and Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commandline/index.html">MAME Command-line Usage and OS-Specific Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">Advanced configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debugger/index.html">MAME Debugger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../luascript/index.html">Lua Scripting Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">MAME External Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing to MAME</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Technical Specifications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="naming.html">MAME Naming Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="layout_files.html">MAME Layout Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="layout_script.html">MAME Layout Scripting</a></li>
<li class="toctree-l2"><a class="reference internal" href="object_finders.html">Object Finders</a></li>
<li class="toctree-l2"><a class="reference internal" href="inputsystem.html">Input System</a></li>
<li class="toctree-l2"><a class="reference internal" href="device_memory_interface.html">The device_memory_interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="device_rom_interface.html">The device_rom_interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="device_disasm_interface.html">The device_disasm_interface and the disassemblers</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">The device_sound_interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory.html">Emulated system memory and address spaces management</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpu_device.html">CPU devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="floppy.html">The new floppy subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="nscsi.html">The new SCSI subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="m6502.html">The new 6502 family implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="uml_instructions.html">UML Instruction Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="poly_manager.html">Software 3D Rendering in MAME</a></li>
<li class="toctree-l2"><a class="reference internal" href="audio_effects.html">Audio effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="osd_audio.html">OSD audio support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">MAME and security concerns</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">The MAME License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MAME Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Technical Specifications</a></li>
      <li class="breadcrumb-item active">The device_sound_interface</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="the-device-sound-interface">
<h1>The device_sound_interface<a class="headerlink" href="#the-device-sound-interface" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#the-sound-system" id="id2">1. The sound system</a></p></li>
<li><p><a class="reference internal" href="#devices-using-device-sound-interface" id="id3">2. Devices using device_sound_interface</a></p>
<ul>
<li><p><a class="reference internal" href="#initialisation" id="id4">2.1 Initialisation</a></p></li>
<li><p><a class="reference internal" href="#sound-input-output" id="id5">2.2 Sound input/output</a></p></li>
<li><p><a class="reference internal" href="#stream-information" id="id6">2.3 Stream information</a></p></li>
<li><p><a class="reference internal" href="#gain-management" id="id7">2.4 Gain management</a></p></li>
<li><p><a class="reference internal" href="#routing-setup" id="id8">2.5 Routing setup</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#streams" id="id9">3. Streams</a></p>
<ul>
<li><p><a class="reference internal" href="#generalities" id="id10">3.1 Generalities</a></p></li>
<li><p><a class="reference internal" href="#characteristics" id="id11">3.2 Characteristics</a></p></li>
<li><p><a class="reference internal" href="#sample-access" id="id12">3.3 Sample access</a></p></li>
<li><p><a class="reference internal" href="#timing" id="id13">3.4 Timing</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id14">3.5 Gain management</a></p></li>
<li><p><a class="reference internal" href="#misc-actions" id="id15">3.6 Misc. actions</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#devices-using-device-mixer-interface" id="id16">4. Devices using device_mixer_interface</a></p></li>
</ul>
</nav>
<section id="the-sound-system">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">1. The sound system</a><a class="headerlink" href="#the-sound-system" title="Link to this heading">¶</a></h2>
<p>The device sound interface is the entry point for devices that handle
sound input and/or output.  The sound system is built on the concept
of <em>streams</em> which connect devices together with resampling and mixing
applied transparently as needed.  Microphones (audio input) and
speakers (audio output) are specific known devices which use the same
interface.</p>
</section>
<section id="devices-using-device-sound-interface">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">2. Devices using device_sound_interface</a><a class="headerlink" href="#devices-using-device-sound-interface" title="Link to this heading">¶</a></h2>
<section id="initialisation">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">2.1 Initialisation</a><a class="headerlink" href="#initialisation" title="Link to this heading">¶</a></h3>
<p>Sound streams must be created in the device_start (or
interface_pre_start) method.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n">sound_stream</span><span class="w"> </span><span class="o">*</span><span class="nf">stream_alloc</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">inputs</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">outputs</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sample_rate</span><span class="p">,</span><span class="w"> </span><span class="n">sound_stream_flags</span><span class="w"> </span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">STREAM_DEFAULT_FLAGS</span><span class="p">);</span>
</pre></div>
</div>
<p>A stream is created with <code class="docutils literal notranslate"><span class="pre">stream_alloc</span></code>.  It takes the number of
input and output channels, the sample rate and optionally flags.</p>
<p>The sample rate can be SAMPLE_RATE_INPUT_ADAPTIVE,
SAMPLE_RATE_OUTPUT_ADAPTIVE or SAMPLE_RATE_ADAPTIVE.  In that case the
chosen sample rate is the highest one among the inputs, outputs or
both respectively.  In case of loop, the chosen sample rate is the
configured global sample rate.</p>
<p>The only available non-default flag is STREAM_SYNCHRONOUS.  When set,
the sound generation method will be called for every sample
individually.  It's necessary for DSPs that run a program on every
sample. but on the other hand it's expensive, so only to be used when
required.</p>
<p>Devices can create multiple streams.  It's rare though.  Some Yamaha
chips should but don't.  Inputs and outputs are numbered from 0 and
arrange all streams in the order they are created.</p>
</section>
<section id="sound-input-output">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">2.2 Sound input/output</a><a class="headerlink" href="#sound-input-output" title="Link to this heading">¶</a></h3>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sound_stream_update</span><span class="p">(</span><span class="n">sound_stream</span><span class="w"> </span><span class="o">&amp;</span><span class="n">stream</span><span class="p">);</span>
</pre></div>
</div>
<p>This method is required to be implemented to consume the input samples
and/or compute the output ones.  The stream to update for is passed as
the parameter.  See the streams section, specifically sample access,
to see how to write the method.</p>
</section>
<section id="stream-information">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">2.3 Stream information</a><a class="headerlink" href="#stream-information" title="Link to this heading">¶</a></h3>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">inputs</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">outputs</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">sound_stream</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">input_to_stream_input</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">inputnum</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">sound_stream</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">output_to_stream_output</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">outputnum</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
</pre></div>
</div>
<p>The method <code class="docutils literal notranslate"><span class="pre">inputs</span></code> returns the total number of inputs in the
streams created by the device.  The method <code class="docutils literal notranslate"><span class="pre">outputs</span></code> similarly
counts the outputs.  The other two methods allow to grab the stream
and channel number for the device corresponding to the global input or
output number.</p>
</section>
<section id="gain-management">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">2.4 Gain management</a><a class="headerlink" href="#gain-management" title="Link to this heading">¶</a></h3>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span><span class="w"> </span><span class="nf">input_gain</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">inputnum</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="kt">float</span><span class="w"> </span><span class="nf">output_gain</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">outputnum</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">set_input_gain</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">inputnum</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">gain</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">set_output_gain</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">outputnum</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">gain</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">set_route_gain</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">source_channel</span><span class="p">,</span><span class="w"> </span><span class="n">device_sound_interface</span><span class="w"> </span><span class="o">*</span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">target_channel</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">gain</span><span class="p">);</span>

<span class="kt">float</span><span class="w"> </span><span class="nf">user_output_gain</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="kt">float</span><span class="w"> </span><span class="nf">user_output_gain</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">outputnum</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">set_user_output_gain</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">gain</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">set_user_output_gain</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">outputnum</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">gain</span><span class="p">);</span>
</pre></div>
</div>
<p>Those methods allow to set the gain on every step of the routes
between streams.  All gains are multipliers, with default value 1.0.
The steps are, from samples output in <code class="docutils literal notranslate"><span class="pre">sound_stream_update</span></code> to
samples read in the next device's <code class="docutils literal notranslate"><span class="pre">sound_stream_update</span></code>:</p>
<ul class="simple">
<li><p>Per-channel output gain</p></li>
<li><p>Per-channel user output gain</p></li>
<li><p>Per-device user output gain</p></li>
<li><p>Per-route gain</p></li>
<li><p>Per-channel input gain</p></li>
</ul>
<p>The user gains must not be set from the driver, they're for use by the
user interface (the sliders) and are saved in the game configuration.
The other gains are for driver/device use, and are saved in save
states.</p>
</section>
<section id="routing-setup">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">2.5 Routing setup</a><a class="headerlink" href="#routing-setup" title="Link to this heading">¶</a></h3>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n">device_sound_interface</span><span class="w"> </span><span class="o">&amp;</span><span class="nf">add_route</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">device_finder</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">gain</span><span class="p">,</span><span class="w"> </span><span class="n">u32</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="n">device_sound_interface</span><span class="w"> </span><span class="o">&amp;</span><span class="n">add_route</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">gain</span><span class="p">,</span><span class="w"> </span><span class="n">u32</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="n">device_sound_interface</span><span class="w"> </span><span class="o">&amp;</span><span class="nf">add_route</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">device_sound_interface</span><span class="w"> </span><span class="o">&amp;</span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">gain</span><span class="p">,</span><span class="w"> </span><span class="n">u32</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="n">device_sound_interface</span><span class="w"> </span><span class="o">&amp;</span><span class="nf">reset_routes</span><span class="p">();</span>
</pre></div>
</div>
<p>Routes between devices, e.g. between streams, are set at configuration
time.  The method <code class="docutils literal notranslate"><span class="pre">add_route</span></code> must be called on the source device
and gives the channel on the source device, the target device, the
gain, and optionally the channel on the target device.  The constant
<code class="docutils literal notranslate"><span class="pre">ALL_OUTPUTS</span></code> can be used to add a route from every channel of the
source to a given channel of the destination.</p>
<p>The method <code class="docutils literal notranslate"><span class="pre">reset_routes</span></code> is used to remove all the routes setup on
a given source device.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n">u32</span><span class="w"> </span><span class="nf">get_sound_requested_inputs</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="n">u32</span><span class="w"> </span><span class="nf">get_sound_requested_outputs</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="n">u64</span><span class="w"> </span><span class="nf">get_sound_requested_inputs_mask</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="n">u64</span><span class="w"> </span><span class="nf">get_sound_requested_outputs_mask</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
</pre></div>
</div>
<p>Those methods are useful for devices which want to behave differently
depending on what routes are set up on them.  You get either the max
number of requested channel plus one (which is the number of channels
when all channels are routed, but is more useful when there are gaps)
or a mask of use for channels 0-63.  Note that <code class="docutils literal notranslate"><span class="pre">ALL_OUTPUTS</span></code> does
not register any specific output or output count.</p>
</section>
</section>
<section id="streams">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">3. Streams</a><a class="headerlink" href="#streams" title="Link to this heading">¶</a></h2>
<section id="generalities">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">3.1 Generalities</a><a class="headerlink" href="#generalities" title="Link to this heading">¶</a></h3>
<p>Streams are endpoints associated with devices and, when connected
together, ensure the transmission of audio data between them.  A
stream has a number of inputs (which can be zero) and outputs (same)
and one sample rate which is common to all inputs and outputs.  The
connections are set up at the machine configuration level and the sound
system ensures mixing and resampling is done transparently.</p>
<p>Samples in streams are encoded as sample_t.  In the current
implementation, this is a float.  Nominal values are between -1 and 1,
but clamping at the device level is not recommended (unless that's
what happens in hardware of course) because the gain values, volume
and effects can easily avoid saturation.</p>
<p>They are implemented in the class <code class="docutils literal notranslate"><span class="pre">sound_stream</span></code>.</p>
</section>
<section id="characteristics">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">3.2 Characteristics</a><a class="headerlink" href="#characteristics" title="Link to this heading">¶</a></h3>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n">device_t</span><span class="w"> </span><span class="o">&amp;</span><span class="nf">device</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="kt">bool</span><span class="w"> </span><span class="nf">input_adaptive</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="kt">bool</span><span class="w"> </span><span class="nf">output_adaptive</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="kt">bool</span><span class="w"> </span><span class="nf">synchronous</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="n">u32</span><span class="w"> </span><span class="nf">input_count</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="n">u32</span><span class="w"> </span><span class="nf">output_count</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="n">u32</span><span class="w"> </span><span class="nf">sample_rate</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="n">attotime</span><span class="w"> </span><span class="nf">sample_period</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="sample-access">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">3.3 Sample access</a><a class="headerlink" href="#sample-access" title="Link to this heading">¶</a></h3>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n">s32</span><span class="w"> </span><span class="nf">samples</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">put</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">sample_t</span><span class="w"> </span><span class="n">sample</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">put_clamp</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">sample_t</span><span class="w"> </span><span class="n">sample</span><span class="p">,</span><span class="w"> </span><span class="n">sample_t</span><span class="w"> </span><span class="n">clamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">put_int</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">sample</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">max</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">put_int_clamp</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">sample</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">maxclamp</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">sample_t</span><span class="w"> </span><span class="n">sample</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">add_int</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">sample</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">max</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">fill</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">sample_t</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">fill</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">sample_t</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">start</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">fill</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">sample_t</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">start</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">input</span><span class="p">);</span>
<span class="n">sample_t</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="n">sample_t</span><span class="w"> </span><span class="nf">get_output</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">s32</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
</pre></div>
</div>
<p>Those are the methods used to implement <code class="docutils literal notranslate"><span class="pre">sound_stream_update</span></code>.
First <code class="docutils literal notranslate"><span class="pre">samples</span></code> tells how many samples to consume and/or generate.
The to-generate samples, if any, are pre-cleared (e.g. set to zero).</p>
<p>Input samples are retrieved with <code class="docutils literal notranslate"><span class="pre">get</span></code>, where <code class="docutils literal notranslate"><span class="pre">input</span></code> is the
stream channel number and <code class="docutils literal notranslate"><span class="pre">index</span></code> the sample number.</p>
<p>Generated samples are written with the put variants.  <code class="docutils literal notranslate"><span class="pre">put</span></code> sets a
sample_t in channel <code class="docutils literal notranslate"><span class="pre">output</span></code> at position <code class="docutils literal notranslate"><span class="pre">index</span></code>.  <code class="docutils literal notranslate"><span class="pre">put_clamp</span></code>
does the same but first clamps the value to +/-<code class="docutils literal notranslate"><span class="pre">clamp</span></code>.  <code class="docutils literal notranslate"><span class="pre">put_int</span></code>
does it with an integer <code class="docutils literal notranslate"><span class="pre">sample</span></code> but pre-divides it by <code class="docutils literal notranslate"><span class="pre">max</span></code>.
<code class="docutils literal notranslate"><span class="pre">put_int_clamp</span></code> does the same but also pre-clamps within
-<code class="docutils literal notranslate"><span class="pre">maxclamp</span></code> and <code class="docutils literal notranslate"><span class="pre">maxclamp</span></code>-1, which is the normal range for a
2-complement value.</p>
<p><code class="docutils literal notranslate"><span class="pre">add</span></code> and <code class="docutils literal notranslate"><span class="pre">add_int</span></code> are similar but add the value of the sample to
what's there instead of replacing.  <code class="docutils literal notranslate"><span class="pre">get_output</span></code> gets the currently
stored output value.</p>
<p><code class="docutils literal notranslate"><span class="pre">fill</span></code> sets a range of an output channel to a given <code class="docutils literal notranslate"><span class="pre">value</span></code>.
<code class="docutils literal notranslate"><span class="pre">start</span></code> tells where to start (default index 0), <code class="docutils literal notranslate"><span class="pre">count</span></code> how many
(default up to the end of the buffer).</p>
<p><code class="docutils literal notranslate"><span class="pre">copy</span></code> does the same as fill but gets its value from the indentical
position in an input channel.</p>
<p>Note that clamping should not be used unless it actually happens in
hardware.  Between gains and effects there is a fair chance saturation
can be avoided later in the chain.</p>
</section>
<section id="timing">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">3.4 Timing</a><a class="headerlink" href="#timing" title="Link to this heading">¶</a></h3>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n">u32</span><span class="w"> </span><span class="nf">sample_rate</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="n">attotime</span><span class="w"> </span><span class="nf">sample_period</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>

<span class="n">u64</span><span class="w"> </span><span class="nf">start_index</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="n">u64</span><span class="w"> </span><span class="nf">end_index</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="n">attotime</span><span class="w"> </span><span class="nf">start_time</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="n">attotime</span><span class="w"> </span><span class="nf">end_time</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>

<span class="n">attotime</span><span class="w"> </span><span class="nf">sample_to_time</span><span class="p">(</span><span class="n">u64</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">sample_rate</span></code> gives the current sample rate of the stream and
<code class="docutils literal notranslate"><span class="pre">sample_period</span></code> the corresponding duration.</p>
<p>Within a call to the update callback, <code class="docutils literal notranslate"><span class="pre">start_index</span></code> gives the number
(starting at zero at system power on) and <code class="docutils literal notranslate"><span class="pre">start_time</span></code> the time of
the first sample to compute in the update.  <code class="docutils literal notranslate"><span class="pre">end_index</span></code> and
<code class="docutils literal notranslate"><span class="pre">end_time</span></code> correspondingly indicate one past the last sample to
update, or in other words the first sample of the next update call.
Outside of an update callback, they all point to the first sample of
the next update call.</p>
<p>Finally <code class="docutils literal notranslate"><span class="pre">sample_to_time</span></code> allows to convert from a sample number to a
time.</p>
<p>Note that in case of change of sample rate sample numbers are
recalculated to end up as if the stream had had the new rate from the
start.  And the times will still be such that sample 0 is at time 0.</p>
</section>
<section id="id1">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">3.5 Gain management</a><a class="headerlink" href="#id1" title="Link to this heading">¶</a></h3>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span><span class="w"> </span><span class="nf">user_output_gain</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">set_user_output_gain</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">gain</span><span class="p">);</span>
<span class="kt">float</span><span class="w"> </span><span class="nf">user_output_gain</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">output</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">set_user_output_gain</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">gain</span><span class="p">);</span>

<span class="kt">float</span><span class="w"> </span><span class="nf">input_gain</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">set_input_gain</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">gain</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">apply_input_gain</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">gain</span><span class="p">);</span>
<span class="kt">float</span><span class="w"> </span><span class="nf">output_gain</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">output</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">set_output_gain</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">gain</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">apply_output_gain</span><span class="p">(</span><span class="n">s32</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">gain</span><span class="p">);</span>
</pre></div>
</div>
<p>This is similar to the device gain control, with a twist: apply
multiplies the current gain by the given value.</p>
</section>
<section id="misc-actions">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">3.6 Misc. actions</a><a class="headerlink" href="#misc-actions" title="Link to this heading">¶</a></h3>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">set_sample_rate</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="n">sample_rate</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">();</span>
</pre></div>
</div>
<p>The method <code class="docutils literal notranslate"><span class="pre">set_sample_rate</span></code> allows to change the sample rate of the
stream.  The method <code class="docutils literal notranslate"><span class="pre">update</span></code> triggers a call of
<code class="docutils literal notranslate"><span class="pre">sound_stream_update</span></code> on the stream and the ones it depends on to
reach the current time in terms of samples.</p>
</section>
</section>
<section id="devices-using-device-mixer-interface">
<h2><a class="toc-backref" href="#id16" role="doc-backlink">4. Devices using device_mixer_interface</a><a class="headerlink" href="#devices-using-device-mixer-interface" title="Link to this heading">¶</a></h2>
<p>The device mixer interface is used for devices that want to relay
sound in the device tree without acting on it.  It's very useful on
for instance slot devices connectors, where the slot device may have
an audio connection with the main system.  They are routed like every
other sound device, create the streams automatically and copy input to
output.  Nothing needs to be done in the device.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="device_disasm_interface.html" class="btn btn-neutral float-left" title="The device_disasm_interface and the disassemblers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="memory.html" class="btn btn-neutral float-right" title="Emulated system memory and address spaces management" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 1997-2025, MAMEdev and contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>