<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Audio effects &mdash; MAME Documentation 0.279 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/documentation_options.js?v=1a7c6e39"></script>
        <script src="../_static/doctools.js?v=9bcbadda"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="OSD audio support" href="osd_audio.html" />
    <link rel="prev" title="Software 3D Rendering in MAME" href="poly_manager.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            MAME Documentation
          </a>
              <div class="version">
                0.279
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../whatis.html">What is MAME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../healthwarning.html">Health Warnings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../initialsetup/index.html">Getting MAME prepared</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usingmame/index.html">Basic MAME Usage and Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commandline/index.html">MAME Command-line Usage and OS-Specific Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">Advanced configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debugger/index.html">MAME Debugger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../luascript/index.html">Lua Scripting Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">MAME External Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing to MAME</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Technical Specifications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="naming.html">MAME Naming Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="layout_files.html">MAME Layout Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="layout_script.html">MAME Layout Scripting</a></li>
<li class="toctree-l2"><a class="reference internal" href="object_finders.html">Object Finders</a></li>
<li class="toctree-l2"><a class="reference internal" href="inputsystem.html">Input System</a></li>
<li class="toctree-l2"><a class="reference internal" href="device_memory_interface.html">The device_memory_interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="device_rom_interface.html">The device_rom_interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="device_disasm_interface.html">The device_disasm_interface and the disassemblers</a></li>
<li class="toctree-l2"><a class="reference internal" href="device_sound_interface.html">The device_sound_interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory.html">Emulated system memory and address spaces management</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpu_device.html">CPU devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="floppy.html">The new floppy subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="nscsi.html">The new SCSI subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="m6502.html">The new 6502 family implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="uml_instructions.html">UML Instruction Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="poly_manager.html">Software 3D Rendering in MAME</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Audio effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="osd_audio.html">OSD audio support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">MAME and security concerns</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">The MAME License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MAME Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Technical Specifications</a></li>
      <li class="breadcrumb-item active">Audio effects</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="audio-effects">
<h1>Audio effects<a class="headerlink" href="#audio-effects" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#generalities" id="id1">1. Generalities</a></p></li>
<li><p><a class="reference internal" href="#audio-effects-aeffects" id="id2">2. audio_effects/aeffects.*</a></p></li>
<li><p><a class="reference internal" href="#audio-effects-youreffect" id="id3">3. audio_effects/youreffect.*</a></p></li>
<li><p><a class="reference internal" href="#frontend-mame-ui-audioeffects-cpp" id="id4">4. frontend/mame/ui/audioeffects.cpp</a></p></li>
<li><p><a class="reference internal" href="#frontend-mame-ui-audioyoureffect" id="id5">5. frontend/mame/ui/audioyoureffect.*</a></p></li>
</ul>
</nav>
<section id="generalities">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">1. Generalities</a><a class="headerlink" href="#generalities" title="Link to this heading">¶</a></h2>
<p>The audio effects are effects that are applied to the sound between
the speaker devices and the actual sound output.  In the current
implementation the effect chain is fixed (but not the effect
parameters), and the parameters are stored in the cfg files.  They are
honestly not really designed for extensibility yet, if ever.</p>
<p>Adding an effect requires working on four parts:</p>
<ul class="simple">
<li><p>audio_effects/aeffects.* for effect object creation and &quot;publishing&quot;</p></li>
<li><p>audio_effects/youreffect.* for the effect implementation</p></li>
<li><p>frontend/mame/ui/audioeffects.cpp to be able to instantiate the effect configuration menu</p></li>
<li><p>frontend/mame/ui/audioyoureffect.* to implement the effect configuration menu</p></li>
</ul>
</section>
<section id="audio-effects-aeffects">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">2. audio_effects/aeffects.*</a><a class="headerlink" href="#audio-effects-aeffects" title="Link to this heading">¶</a></h2>
<p>The audio_effect class in the aeffect sources provides three things:</p>
<ul class="simple">
<li><p>an enum value to designate the effect type and which must match its
position in the chain (iow, the effect chain follows the enum order),
in the .h</p></li>
<li><p>the effect name in the audio_effect::effect_names array in the .cpp</p></li>
<li><p>the creation of a correct effect object in audio_effect::create in the .cpp</p></li>
</ul>
</section>
<section id="audio-effects-youreffect">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">3. audio_effects/youreffect.*</a><a class="headerlink" href="#audio-effects-youreffect" title="Link to this heading">¶</a></h2>
<p>This is where you implement the effect.  It takes the shape of an
audio_effect_youreffect class which derives from audio_effect.</p>
<p>The methods to implement are:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n">audio_effect_youreffect</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="n">sample_rate</span><span class="p">,</span><span class="w"> </span><span class="n">audio_effect</span><span class="w"> </span><span class="o">*</span><span class="n">def</span><span class="p">);</span>

<span class="k">virtual</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">type</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">config_load</span><span class="p">(</span><span class="n">util</span><span class="o">::</span><span class="n">xml</span><span class="o">::</span><span class="n">data_node</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="n">ef_node</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">config_save</span><span class="p">(</span><span class="n">util</span><span class="o">::</span><span class="n">xml</span><span class="o">::</span><span class="n">data_node</span><span class="w"> </span><span class="o">*</span><span class="n">ef_node</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">default_changed</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="k">virtual</span><span class="w"> </span><span class="n">u32</span><span class="w"> </span><span class="nf">history_size</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"> </span><span class="c1">// optional</span>
</pre></div>
</div>
<p>The constructor must pass the parameters to <code class="docutils literal notranslate"><span class="pre">audio_effect</span></code> and
initialize the effect parameters.  <code class="docutils literal notranslate"><span class="pre">type</span></code> must return the enum value
for the effect.  <code class="docutils literal notranslate"><span class="pre">config_load</span></code> and <code class="docutils literal notranslate"><span class="pre">config_save</span></code> should load or
save the effect parameters from/to the cfg file xml tree.
<code class="docutils literal notranslate"><span class="pre">default_changed</span></code> is called when the parameters in <code class="docutils literal notranslate"><span class="pre">m_default</span></code> are
changed and the parameters may need to be updated.  <code class="docutils literal notranslate"><span class="pre">history_size</span></code>
allows to tell how many samples should still be available of the
previous input frame.  Note that this number must not depend on the
parameters and only on the sample rate.</p>
<p>An effect has a number of parameters that can come from three sources:</p>
<ul class="simple">
<li><p>fixed default value</p></li>
<li><p>equivalent effect object from the default effect chain</p></li>
<li><p>user setting through the UI</p></li>
</ul>
<p>The first two are recognized through the value of <code class="docutils literal notranslate"><span class="pre">m_default</span></code> which
gets the value of <code class="docutils literal notranslate"><span class="pre">def</span></code> in the constructor.  When it's nullptr, the
value to use when not set by the user is the fixed one, otherwise it's
the one in <code class="docutils literal notranslate"><span class="pre">m_default</span></code>.</p>
<p>At minimum an effect should have a parameter allowing to bypass it.</p>
<p>Managing a parameter uses four methods:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">param()</span> <span class="pre">const;</span></code>  returns the current parameter value</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">set_param(type</span> <span class="pre">value);</span></code>  sets the current parameter value and marks it as set by the user</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">isset_param()</span> <span class="pre">const;</span></code>  returns true is the parameter was set by the user</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">reset_param();</span></code>  resets the parameter to the default value (from m_default or fixed) and marks it as not set by the user</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">config_save</span></code> must only save the user-set parameters.
<code class="docutils literal notranslate"><span class="pre">config_load</span></code> must retrieve the parameters that are present and mark
them as set by the user and reset all the others.</p>
<p>Finally the actual implementation goes into the <code class="docutils literal notranslate"><span class="pre">apply</span></code> method:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">emu</span><span class="o">::</span><span class="n">detail</span><span class="o">::</span><span class="n">output_buffer_flat</span><span class="o">&lt;</span><span class="n">sample_t</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">emu</span><span class="o">::</span><span class="n">detail</span><span class="o">::</span><span class="n">output_buffer_flat</span><span class="o">&lt;</span><span class="n">sample_t</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">dest</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
</pre></div>
</div>
<p>That method takes two buffers with the same number of channels and has
to apply the effect to <code class="docutils literal notranslate"><span class="pre">src</span></code> to produce <code class="docutils literal notranslate"><span class="pre">dest</span></code>.  The
<code class="docutils literal notranslate"><span class="pre">output_buffer_flat</span></code> is non-interleaved with independent per-channel
buffers.</p>
<p>To make bypassing easier, the <code class="docutils literal notranslate"><span class="pre">copy(src,</span> <span class="pre">dest)</span></code> method of
audio_effect allows to copy the samples from <code class="docutils literal notranslate"><span class="pre">src</span></code> to <code class="docutils literal notranslate"><span class="pre">dest</span></code>
without changing them.</p>
<p>The effect application part should looks like:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n">u32</span><span class="w"> </span><span class="n">samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">.</span><span class="n">available_samples</span><span class="p">();</span>
<span class="n">dest</span><span class="p">.</span><span class="n">prepare_space</span><span class="p">(</span><span class="n">samples</span><span class="p">);</span>
<span class="n">u32</span><span class="w"> </span><span class="n">channels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">.</span><span class="n">channels</span><span class="p">();</span>

<span class="c1">// generate channels * samples results and put them in dest</span>

<span class="n">dest</span><span class="p">.</span><span class="n">commit</span><span class="p">(</span><span class="n">samples</span><span class="p">);</span>
</pre></div>
</div>
<p>To get pointers to the buffers, one uses:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="n">sample_t</span><span class="w"> </span><span class="o">*</span><span class="n">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">.</span><span class="n">ptrs</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span><span class="w"> </span><span class="n">source_index</span><span class="p">);</span><span class="w"> </span><span class="c1">// source_index must be in [-history_size()..samples-1]</span>
<span class="n">sample_t</span><span class="w"> </span><span class="o">*</span><span class="n">destination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dest</span><span class="p">.</span><span class="n">ptrw</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span><span class="w"> </span><span class="n">destination_index</span><span class="p">);</span><span class="w"> </span><span class="c1">// destination_index must be in [0..samples-1]</span>
</pre></div>
</div>
<p>The samples pointed by source and destination are contiguous.  The
number of channels will not change from one apply call to another, the
number of samples will vary though.  Also the call happens in a
different thread than the main thread and also in a different thread
than the parameter setting calls are made from.</p>
</section>
<section id="frontend-mame-ui-audioeffects-cpp">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">4. frontend/mame/ui/audioeffects.cpp</a><a class="headerlink" href="#frontend-mame-ui-audioeffects-cpp" title="Link to this heading">¶</a></h2>
<p>Here it suffices to add a creation of the menu
menu_audio_effect_youreffect in menu_audio_effects::handle.  The menu
effect will pick the effect names from audio_effect (in aeffect.*).</p>
</section>
<section id="frontend-mame-ui-audioyoureffect">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">5. frontend/mame/ui/audioyoureffect.*</a><a class="headerlink" href="#frontend-mame-ui-audioyoureffect" title="Link to this heading">¶</a></h2>
<p>This is used to implement the configuration menu for the effect.  It's
a little complicated because it needs to generate the list of
parameters and their values, set left or right arrow flags depending
on the possible modifications, dim them (FLAG_INVERT) when not set by
the user, and manage the arrows and clear keys to change them.  Just
copy an existing one and change it as needed.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="poly_manager.html" class="btn btn-neutral float-left" title="Software 3D Rendering in MAME" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="osd_audio.html" class="btn btn-neutral float-right" title="OSD audio support" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 1997-2025, MAMEdev and contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>